---
title: 'Next.js에서 Redux 적용해보기'
date: 2018-06-16 09:45:00 +0900
---

### 들어가기 전에 이 글에서 사용하는 기술

- Node.js(v8) & Express MVC Framework(v4)
- React(v16) & Next.js(v6)
- Redux

### 간단한 세팅

```
yarn add react-redux redux redux-thunk
```

위와 같이 react-redux, redux, redux-thunk를 설치한다. react-redux는 React에서 Redux를 사용할 수
있도록 기능을 제공해준다. redux는 더 설명할 것 없이 Redux 기능 그 자체이다. redux-thunk는
Redux에서 비동기 통신을 위해 사용하는 라이브러리이다. Next.js 프로젝트를 처음부터 구성해야하는
사람이라면 next, react, react-dom도 패키지매니저로 설치해주어야 한다. 하지만, Next.js와 Redux를
동시에 검색한 분들이라면 기본적으로 Next.js를 설치하고 프로젝트를 간단하게나마 구성한 사람으로
생각이 들기에 기본적인 구성은 마쳤다는 가정을 하고 포스팅을 하겠다.

### 예제 시작. 간단한 Redux 스토어부터 만들기

아주 간단한 Redux 예제로 작성 예정이다.

```
/* ./stores.js */
import { createStore, applyMiddleware } from 'redux';
import thunk from 'redux-thunk';
import index from './reducers/index';
const finalCreateStore = applyMiddleware(thunk)(createStore);
export default finalCreateStore(index);
```

```
/* reducer, ./reducers/index.js */
import { combineReducers } from 'redux';
import members from './members';
/* 여러 Reducer를 묶는다. 현재 예제는 하나이지만 추후에 여러 개 Reducer를 생성 예정이라면 아래와 같이 사용하면 된다. */
export default combineReducers({
  members
});
......
/* reducer, ./reducers/members.js */
function members(state = { id: '' }, action) {
  switch (action.type) {
    case 'checkSignInStatus': {
      return {
        ...state,
        id: action.id,
      };
    }
    default:
      return state;
  }
}
export default members;
```

```
/* action, ./actions/members.js */
const checkSignInStatus = reqDataObj => ({
  type: 'checkSignInStatus',
  id: reqDataObj.id
});
module.exports = {
  checkSignInStatus
};
```

위의 코드의 의미를 간단하게 설명하자면 로그인 데이터 정보를 세션으로부터 받아와서 관리하기 위한 로직이라고 보면 되겠다. Express Session 데이터를 가져오는 로직은 이번 포스팅에서 다루지 않을 것이다.
아무튼 이렇게 하나의 매우 간단한 Redux 스토어를 만들었다.
이것을 그러면 어떻게 적용시켜야 할까?

### `_app.js`에서 Provider 사용

먼저 `./pages` 디렉토리에 `_app.js`를 생성하고 아래와 같이 코드를 작성하자.

```
import App, { Container } from 'next/app';
import React from 'react';
import { Provider } from 'react-redux';
import store from '../store';
export default class MyApp extends App {
  render() {
    const { Component, pageProps } = this.props;
    return (
      <Container>
        <Provider store={store}>
          <Component {...pageProps} />
        </Provider>
      </Container>
    );
  }
}
```

끝이다. default 구조를 기반으로 해서 추가해준 구문은 코드의 3, 4 line과 Container 태그 안의 Provider 태그 밖에 없다.
필요에 따라 mapStateToProps 함수를 만들어서 해당 컴포넌트에서 직접 호출하며 활용하면 될 것이다.
`_app.js`는 이렇게 사용자가 커스터마이징을 통해 전역적인 관리가 가능하다.
하지만 [공식 문서](https://zeit.co/blog/next6#app-component)를 참고했을 때 data fetching과 runtime Lifycycle은 `_app.js` 안에서만 처리가 가능하다고 하니 참고하도록 하자.
또한 [Next Github](https://github.com/zeit/next.js#custom-app)에 custom `_app.js`, custom `_document.js`에 대한 언급이 있다.
간단히 설명하자면 \_document.js는 server 렌더링에서 작동하고 `_app.js`는 페이지 변경 간의 레이아웃 유지, 네비게이팅 상태에 있어서 유지할 수 있다고 언급되어 있다.
이런 특징들을 잘 숙지하여 잘 활용해보도록 하자.

```
/* ./pages/index.js */
import React, { Component } from "react";
import { connect } from "react-redux";
import Nav from "../components/Nav";
class Index extends Component {
  render() {
    const { members } = this.props;
    return (
      <React.Fragment>
        <Nav />
        <h1>This is Home</h1>
        <h2>Hello {members.id !== "" ? members.id : "Guest"}!</h2>
      </React.Fragment>
    );
  }
}
function mapStateToProps(state) {
  return {
    members: state.members
  };
}
export default connect(mapStateToProps)(Index);
```

위와 같이 `./pages` 디렉토리의 페이지 파일에서 `connect` 해준다면 끝.
아래와 같은 화면을 볼 수 있다.
여기서 `member.id`의 값을 `dispatch`로 값을 입력해주는 함수가 있다면 Guest가 아닌 원하는 id의 값을 볼 수가 있을 것이다.

<img src="/2018/06/16/next-js-redux/home.png" />

## 끝.
